#IDEAS

each layer set depth test as it wish.

# 1 approach
list of tests set:
each frame on render enable tests required by current layer

dont know if disable test at the end.

It’s cheap:
glEnable/Disable(TEST)

Enable/Disable (ms), Clock (1.53GHz)
GL_ALPHA_TEST 2.2488892e-005; 34
GL_BLEND 2.891429e-005; 44
GL_COLOR_MATERIAL 5.782858e-005; 88
GL_CULL_FACE 2.3047622e-005; 35
GL_CLIP_PLANE0 3.1288891e-005; 47
GL_DEPTH_TEST 2.891429e-005; 44
GL_DITHER 2.6679369e-005; 40
GL_FOG 2.3746035e-005; 36
GL_LIGHTING 0.00013367621; 204
GL_LINE_STIPPLE 1.8298415e-005; 28
GL_LINE_SMOOTH 4.1904768e-005; 64
GL_LOGIC_OP 2.6819051e-005; 41
GL_NORMALIZE 2.5003177e-005; 38
GL_POINT_SMOOTH 1.8019049e-005; 27
GL_POLYGON_SMOOTH 2.2628574e-005; 34
GL_POLYGON_STIPPLE 2.234921e-005; 34
GL_SCISSOR_TEST 0.00042449529; 650
GL_STENCIL_TEST 2.3187304e-005; 35
GL_TEXTURE_1D 3.1987307e-005; 49
GL_TEXTURE_2D 3.1987307e-005; 49